clone_folder: C:\repo

matrix:
  fast_finish: true

environment:
  global:
    DOWNLOAD_DIR: _download_cache
    APPVEYOR_SAVE_CACHE_ON_ERROR: true
    #PATH: C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Program Files\Git\cmd;C:\Program Files\cURL\bin
  matrix:
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
      VS_VER: "14"
      PLATFORM: "x86"
      PYTHON: C:\Python36\python.exe

build_script:
  - "%PYTHON% --version"
  - echo %cd%
  - dir
  - set PATH
  - cd win
  - "%PYTHON% -m pip install -r requirements.txt"
  - curl -Lo gtk.tar.gz https://ci.appveyor.com/api/buildjobs/5b431yy5h0ifc822/artifacts/gvsbuild-vs14-x86.tar.gz
  - tar.exe -xzf gtk.tar.gz
  - move release C:\gtk
  - dir C:\gtk
  - set PATH=%PATH%;C:\gtk\bin
  - "%PYTHON% -m pip install pycairo-1.17.1-cp36-cp36m-win32.whl C:/gtk/python/PyGObject-3.28.3-cp36-cp36m-win32.whl"
  - "%PYTHON% ../rednotebook/journal.py"
  - "%PYTHON% -m PyInstaller --workpath C:/build --distpath C:/ rednotebook.spec"
  #- "%PYTHON% -m PyInstaller ../rednotebook/journal.py"
  - dir C:\repo\rednotebook
  - dir C:\build
  - dir C:\dist
  #- "%PYTHON% build-translations.py C:\dist\share\locale"
  - tar.exe -czf rednotebook.tar.gz -C /c/ dist
  - move rednotebook.tar.gz C:\repo

artifacts:
  - path: rednotebook.tar.gz

cache:
  - '%DOWNLOAD_DIR%'

deploy: off

test: off
