clone_folder: C:\repo

matrix:
  fast_finish: true

environment:
  global:
    DOWNLOAD_DIR: _download_cache
    APPVEYOR_SAVE_CACHE_ON_ERROR: true
    PATH: C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Program Files\Git\cmd;C:\msys64\usr\bin
  matrix:
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
      VS_VER: "14"
      PLATFORM: "x86"
      PYTHON: C:\Python36\python.exe

build_script:
  - "%PYTHON% --version"
  - echo %cd%
  - dir
  - set PATH
  - cd win
  - C:\Tools\curl\bin\curl -Lo gtk.tar.gz https://ci.appveyor.com/api/buildjobs/esg55wmrhjy696yr/artifacts/gvsbuild-vs14-x86.tar.gz
  - C:\msys64\usr\bin\tar.exe -xzf gtk.tar.gz
  - move release C:\gtk
  - "%PYTHON% -m pip install -U pip"
  - "%PYTHON% -m pip install -U wheel"
  - "%PYTHON% -m pip install C:/gtk/python/pycairo-1.17.1-cp36-cp36m-win32.whl C:/gtk/python/PyGObject-3.28.3-cp36-cp36m-win32.whl"
  - set PATH=%PATH%;C:\gtk\bin
  - "%PYTHON% -c \"import os; print(os.getenv('PATH'))\""
  - "%PYTHON% sampleapp.py"
  # Install pyenchant without the DLLs. They mess up the build system and lead to
  # the error "ImportError: DLL load failed: The specified procedure could not be found."
  # when calling "import gi".
  - "%PYTHON% -m pip install -r requirements.txt"
  - "%PYTHON% -m PyInstaller --debug=all --additional-hooks-dir=. sampleapp.py"
  - dist\sampleapp\sampleapp.exe
  - "%PYTHON% -m PyInstaller --debug=all --workpath=C:/build --distpath=C:/ rednotebook.spec"
  #- C:\dist\rednotebook.exe
  - dir C:\repo\rednotebook
  - dir C:\build
  - dir C:\dist
  #- "%PYTHON% build-translations.py C:\dist\share\locale"
  - tar.exe -czf rednotebook.tar.gz -C /c/ dist
  - move rednotebook.tar.gz C:\repo

artifacts:
  - path: rednotebook.tar.gz

cache:
  - '%DOWNLOAD_DIR%'

deploy: off

test: off
